<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>结婚生育成本计算器</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide-react@0.263.1/umd/lucide-react.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const {
            XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ComposedChart, Bar, Line, ReferenceLine, Area
        } = Recharts;

        const {
            Wallet, BrainCircuit, Loader2, Scale, ShoppingBag, ShieldCheck, AlertTriangle, ArrowRight, Baby, Coins, Home, TrendingDown, TrendingUp
        } = LucideReact;

        const App = () => {
            const [formData, setFormData] = React.useState({
                // 收入与稳定性
                salaryA: 15000,
                salaryB: 12000,
                annualBonus: 50000,
                incomeStability: 90, // 工资稳定性 (0-100)

                // 房产资产 (考虑增值/贬值)
                propertyValue: 3000000,
                propertyAppreciation: -1.5, // 预期年化增值率 (负数为贬值)
                monthlyMortgage: 8000,      // 总月供

                // 父母支持
                annualParentSupport: 30000, // 父母每年现金流支撑

                // 结婚成本细分
                marriageCosts: {
                    betrothalGift: 100000,    // 彩礼
                    weddingCeremony: 50000,   // 婚礼
                    weddingRing: 30000,       // 钻戒首饰
                    honeymoon: 30000,         // 蜜月旅行
                    newHouseDownPayment: 500000, // 新房首付
                    renovation: 200000,       // 装修
                },

                // 生育与育儿成本
                childCount: 1,
                cityTier: 'tier2',
                children: [
                    {
                        prenatalCare: 8000,     // 产检费用
                        delivery: 15000,         // 分娩费用
                        postpartumCare: 20000,   // 月子中心
                        monthlyBabyCost: 2000,   // 月均婴儿用品
                        kindergarten: 150000,    // 幼儿园3年
                        primarySchool: 300000,   // 小学6年
                        juniorHigh: 250000,      // 初中3年
                        seniorHigh: 200000,      // 高中3年
                        university: 800000,      // 本科4年
                        extracurricular: 100000, // 课外辅导
                    }
                ],

                // 生活成本与通胀
                baseLivingCost: 5000,
                livingInflation: 2.5,  // 货币贬值/生活通胀
                investmentReturn: 3.5, // 家庭投资年化收益率

                riskSimulation: false
            });

            const [aiAdvice, setAiAdvice] = React.useState("");
            const [isGenerating, setIsGenerating] = React.useState(false);

            const analysis = React.useMemo(() => {
                const {
                    salaryA, salaryB, annualBonus, incomeStability,
                    propertyValue, propertyAppreciation, monthlyMortgage,
                    annualParentSupport, childCount, cityTier, marriageCosts, children,
                    baseLivingCost, livingInflation, investmentReturn
                } = formData;

                // 结婚总成本
                const totalMarriageCost = Object.values(marriageCosts).reduce((sum, cost) => sum + cost, 0);

                // 计算每个孩子的总教育成本
                const childEducationCost = children.reduce((total, child) => {
                    return total + (
                        child.prenatalCare + child.delivery + child.postpartumCare +
                        child.monthlyBabyCost * 12 * 3 + // 3年婴儿期
                        child.kindergarten + child.primarySchool + child.juniorHigh +
                        child.seniorHigh + child.university + child.extracurricular
                    );
                }, 0);

                const stages = [
                    { name: '结婚准备', years: 1, isMarriageStage: true },
                    { name: '0-3岁', years: 3 },
                    { name: '3-6岁', years: 3 },
                    { name: '6-12岁', years: 6 },
                    { name: '12-15岁', years: 3 },
                    { name: '15-18岁', years: 3 }
                ];

                let currentPropertyValue = propertyValue;
                let totalNetAssetsChange = -totalMarriageCost; // 结婚成本作为初始支出
                let minCashFlowSurplus = Infinity;

                const chartData = stages.map((s, idx) => {
                    const yearCount = s.years;
                    const elapsedYears = Math.max(0, (idx - 1) * 3); // 结婚阶段elapsedYears为0

                    // 1. 收入计算 (考虑稳定性波动)
                    const annualIncomeBase = (salaryA + salaryB) * 12 + annualBonus;
                    const effectiveAnnualIncome = annualIncomeBase * (incomeStability / 100);
                    const stageIncome = s.isMarriageStage ? 0 : effectiveAnnualIncome * yearCount; // 结婚阶段无收入

                    // 2. 支出计算 (考虑通胀)
                    const stageLivingCost = s.isMarriageStage ? 0 : baseLivingCost * 12 * yearCount * Math.pow(1 + livingInflation/100, elapsedYears);
                    const stageMortgage = s.isMarriageStage ? 0 : monthlyMortgage * 12 * yearCount;

                    // 3. 育儿成本 (详细细分)
                    let stageChildCost = 0;
                    if (!s.isMarriageStage) {
                        if (idx === 1) { // 0-3岁阶段
                            stageChildCost = children.reduce((total, child) => {
                                return total + (child.prenatalCare + child.delivery + child.postpartumCare + child.monthlyBabyCost * 12 * 3);
                            }, 0) * childCount;
                        } else if (idx === 2) { // 3-6岁阶段
                            stageChildCost = children.reduce((total, child) => {
                                return total + child.kindergarten;
                            }, 0) * childCount;
                        } else if (idx === 3) { // 6-12岁阶段
                            stageChildCost = children.reduce((total, child) => {
                                return total + child.primarySchool;
                            }, 0) * childCount;
                        } else if (idx === 4) { // 12-15岁阶段
                            stageChildCost = children.reduce((total, child) => {
                                return total + child.juniorHigh;
                            }, 0) * childCount;
                        } else if (idx === 5) { // 15-18岁阶段
                            stageChildCost = children.reduce((total, child) => {
                                return total + child.seniorHigh + child.extracurricular;
                            }, 0) * childCount;
                        }
                        stageChildCost *= Math.pow(1 + livingInflation/100, elapsedYears);
                    }

                    // 4. 结婚成本 (一次性支出)
                    const stageMarriageCost = s.isMarriageStage ? totalMarriageCost : 0;

                    // 5. 房产净值变化 (增值/贬值)
                    const propertyValueAtEnd = currentPropertyValue * Math.pow(1 + propertyAppreciation/100, yearCount);
                    const stagePropertyGain = propertyValueAtEnd - currentPropertyValue;
                    currentPropertyValue = propertyValueAtEnd;

                    // 6. 投资收益与父母支持
                    const stageSupport = s.isMarriageStage ? 0 : annualParentSupport * yearCount;
                    const stageInvestGain = s.isMarriageStage ? 0 : (stageIncome * 0.2) * (investmentReturn / 100) * yearCount;

                    // 7. 最终净现金流 (收入 + 支持 - 生活 - 房贷 - 育儿 - 结婚)
                    const netCashFlow = stageIncome + stageSupport - stageLivingCost - stageMortgage - stageChildCost - stageMarriageCost;

                    // 8. 综合损益 (现金流 + 资产增值/贬值)
                    const totalEconomicGain = netCashFlow + stagePropertyGain + stageInvestGain;

                    if (netCashFlow < minCashFlowSurplus && !s.isMarriageStage) minCashFlowSurplus = netCashFlow;
                    totalNetAssetsChange += totalEconomicGain;

                    return {
                        name: s.name,
                        净现金流: Math.round(netCashFlow),
                        资产增值贬值: Math.round(stagePropertyGain),
                        投资与支持: Math.round(stageInvestGain + stageSupport),
                        结婚生育成本: Math.round(stageMarriageCost + stageChildCost),
                        综合家庭损益: Math.round(totalEconomicGain),
                        isNegative: netCashFlow < 0,
                        isMarriageStage: s.isMarriageStage
                    };
                });

                return {
                    chartData,
                    totalNetAssetsChange,
                    minCashFlowSurplus,
                    totalMarriageCost,
                    childEducationCost: childEducationCost * childCount,
                    totalCost: totalMarriageCost + childEducationCost * childCount
                };
            }, [formData]);

            const generateAIAdvice = async () => {
                setIsGenerating(true);
                const apiKey = ""; // 请填入您的API密钥
                const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                const prompt = `
                    请分析以下复杂的家庭财务状况并给出避险建议：
                    1. 房产：总值${formData.propertyValue}元，预期年化${formData.propertyAppreciation}% (增值/贬值损益)。
                    2. 负债：月供${formData.monthlyMortgage}元。
                    3. 收入稳定性：${formData.incomeStability}% (反映行业风险)。
                    4. 投资回报：年化${formData.investmentReturn}% vs 货币贬值${formData.livingInflation}%。
                    5. 结婚成本：${analysis.totalMarriageCost}元，教育成本：${analysis.childEducationCost}元。
                    6. 18年综合家庭损益预测：${analysis.totalNetAssetsChange}元。

                    请从"资产流动性"、"房产抗风险能力"和"中产返贫风险"三个维度深入评价。
                `;

                try {
                    const response = await fetch(endpoint, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const result = await response.json();
                    setAiAdvice(result.candidates?.[0]?.content?.parts?.[0]?.text || "分析失败。");
                } catch (err) {
                    setAiAdvice("服务繁忙，请稍后再试。");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-900">
                    <div className="max-w-7xl mx-auto space-y-6">
                        {/* Header */}
                        <div className="bg-slate-900 text-white p-8 rounded-[2rem] shadow-xl flex flex-col md:flex-row justify-between items-center gap-6 border-l-[12px] border-amber-500">
                            <div className="flex items-center gap-5">
                                <div className="bg-amber-500 p-4 rounded-2xl shadow-lg"><Scale size={28} /></div>
                                <div>
                                    <h1 className="text-2xl font-black">资产头寸与生存压力模型</h1>
                                    <p className="text-slate-400 text-xs">动态计入房产波动、货币贬值、收入稳定性与隔代支持</p>
                                </div>
                            </div>
                            <div className="bg-white/5 backdrop-blur-md p-5 rounded-2xl border border-white/10 text-right">
                                <span className="text-[10px] font-bold text-amber-400 uppercase tracking-widest">18年综合净资产变化预期</span>
                                <div className={`text-3xl font-mono font-black mt-1 ${analysis.totalNetAssetsChange < 0 ? 'text-rose-500' : 'text-emerald-400'}`}>
                                    ¥{(analysis.totalNetAssetsChange / 10000).toFixed(1)}w
                                </div>
                            </div>
                        </div>

                        <div className="grid lg:grid-cols-12 gap-6">
                            {/* Controls */}
                            <div className="lg:col-span-4 space-y-4">
                                {/* 结婚成本模块 */}
                                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-200">
                                    <h3 className="text-xs font-black text-slate-400 uppercase mb-4 flex items-center gap-2">
                                        <Wallet size={14} className="text-pink-500" /> 结婚成本明细
                                    </h3>
                                    <div className="space-y-3">
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">彩礼</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.marriageCosts.betrothalGift} onChange={e=>setFormData(p=>({...p, marriageCosts:{...p.marriageCosts, betrothalGift:Number(e.target.value)}}))} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">婚礼</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.marriageCosts.weddingCeremony} onChange={e=>setFormData(p=>({...p, marriageCosts:{...p.marriageCosts, weddingCeremony:Number(e.target.value)}}))} />
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">钻戒首饰</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.marriageCosts.weddingRing} onChange={e=>setFormData(p=>({...p, marriageCosts:{...p.marriageCosts, weddingRing:Number(e.target.value)}}))} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">蜜月旅行</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.marriageCosts.honeymoon} onChange={e=>setFormData(p=>({...p, marriageCosts:{...p.marriageCosts, honeymoon:Number(e.target.value)}}))} />
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">新房首付</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.marriageCosts.newHouseDownPayment} onChange={e=>setFormData(p=>({...p, marriageCosts:{...p.marriageCosts, newHouseDownPayment:Number(e.target.value)}}))} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">装修</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.marriageCosts.renovation} onChange={e=>setFormData(p=>({...p, marriageCosts:{...p.marriageCosts, renovation:Number(e.target.value)}}))} />
                                            </div>
                                        </div>
                                        <div className="bg-pink-50 p-2 rounded-lg">
                                            <div className="text-[10px] font-bold text-pink-600">结婚总成本: ¥{(analysis.totalMarriageCost / 10000).toFixed(1)}万</div>
                                        </div>
                                    </div>
                                </div>

                                {/* 房产与负债模块 */}
                                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-200">
                                    <h3 className="text-xs font-black text-slate-400 uppercase mb-4 flex items-center gap-2">
                                        <Home size={14} className="text-blue-500" /> 房产资产与负债
                                    </h3>
                                    <div className="space-y-4">
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-bold text-slate-500">房产当前总市值</label>
                                            <input type="number" className="w-full bg-slate-50 p-2 rounded-xl text-xs font-bold" value={formData.propertyValue} onChange={e=>setFormData(p=>({...p, propertyValue:Number(e.target.value)}))} />
                                        </div>
                                        <div className="space-y-1">
                                            <div className="flex justify-between">
                                                <label className="text-[10px] font-bold text-slate-500">预期年化增值/贬值 (%)</label>
                                                <span className={`text-[10px] font-black ${formData.propertyAppreciation < 0 ? 'text-rose-500' : 'text-emerald-500'}`}>{formData.propertyAppreciation}%</span>
                                            </div>
                                            <input type="range" min="-10" max="10" step="0.5" className="w-full h-1.5 bg-slate-100 rounded-lg accent-blue-500" value={formData.propertyAppreciation} onChange={e=>setFormData(p=>({...p, propertyAppreciation:Number(e.target.value)}))} />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-bold text-slate-500">月供总额 (所有房产)</label>
                                            <input type="number" className="w-full bg-slate-50 p-2 rounded-xl text-xs font-bold" value={formData.monthlyMortgage} onChange={e=>setFormData(p=>({...p, monthlyMortgage:Number(e.target.value)}))} />
                                        </div>
                                    </div>
                                </div>

                                {/* 生育成本模块 */}
                                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-200">
                                    <h3 className="text-xs font-black text-slate-400 uppercase mb-4 flex items-center gap-2">
                                        <Baby size={14} className="text-purple-500" /> 生育教育成本明细
                                    </h3>
                                    <div className="space-y-3">
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">产检费用</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.children[0].prenatalCare} onChange={e=>setFormData(p=>({...p, children:[{...p.children[0], prenatalCare:Number(e.target.value)}]}))} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">分娩费用</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.children[0].delivery} onChange={e=>setFormData(p=>({...p, children:[{...p.children[0], delivery:Number(e.target.value)}]}))} />
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">月子中心</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.children[0].postpartumCare} onChange={e=>setFormData(p=>({...p, children:[{...p.children[0], postpartumCare:Number(e.target.value)}]}))} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">月均婴儿用品</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.children[0].monthlyBabyCost} onChange={e=>setFormData(p=>({...p, children:[{...p.children[0], monthlyBabyCost:Number(e.target.value)}]}))} />
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">幼儿园3年</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.children[0].kindergarten} onChange={e=>setFormData(p=>({...p, children:[{...p.children[0], kindergarten:Number(e.target.value)}]}))} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">小学6年</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.children[0].primarySchool} onChange={e=>setFormData(p=>({...p, children:[{...p.children[0], primarySchool:Number(e.target.value)}]}))} />
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">初中3年</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.children[0].juniorHigh} onChange={e=>setFormData(p=>({...p, children:[{...p.children[0], juniorHigh:Number(e.target.value)}]}))} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">高中3年</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.children[0].seniorHigh} onChange={e=>setFormData(p=>({...p, children:[{...p.children[0], seniorHigh:Number(e.target.value)}]}))} />
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">本科4年</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.children[0].university} onChange={e=>setFormData(p=>({...p, children:[{...p.children[0], university:Number(e.target.value)}]}))} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-500">课外辅导</label>
                                                <input type="number" className="w-full bg-slate-50 p-1.5 rounded-lg text-xs font-bold" value={formData.children[0].extracurricular} onChange={e=>setFormData(p=>({...p, children:[{...p.children[0], extracurricular:Number(e.target.value)}]}))} />
                                            </div>
                                        </div>
                                        <div className="bg-purple-50 p-2 rounded-lg">
                                            <div className="text-[10px] font-bold text-purple-600">教育总成本: ¥{(analysis.childEducationCost / 10000).toFixed(1)}万 × {formData.childCount}孩子</div>
                                            <div className="text-[10px] font-bold text-purple-600">生育总成本: ¥{(analysis.totalCost / 10000).toFixed(1)}万</div>
                                        </div>
                                    </div>
                                </div>

                                {/* 经济环境模块 */}
                                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-200">
                                    <h3 className="text-xs font-black text-slate-400 uppercase mb-4 flex items-center gap-2">
                                        <TrendingUp size={14} className="text-emerald-500" /> 宏观环境与稳定性
                                    </h3>
                                    <div className="space-y-4">
                                        <div className="space-y-1">
                                            <div className="flex justify-between">
                                                <label className="text-[10px] font-bold text-slate-500">工资稳定性/行业Beta (%)</label>
                                                <span className="text-[10px] font-black">{formData.incomeStability}%</span>
                                            </div>
                                            <input type="range" min="30" max="100" step="5" className="w-full h-1.5 bg-slate-100 rounded-lg accent-slate-800" value={formData.incomeStability} onChange={e=>setFormData(p=>({...p, incomeStability:Number(e.target.value)}))} />
                                        </div>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="space-y-1">
                                                <label className="text-[10px] font-bold text-slate-500">父母每年现金支持</label>
                                                <input type="number" className="w-full bg-slate-50 p-2 rounded-xl text-xs font-bold" value={formData.annualParentSupport} onChange={e=>setFormData(p=>({...p, annualParentSupport:Number(e.target.value)}))} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[10px] font-bold text-slate-500">投资收益率 %</label>
                                                <input type="number" className="w-full bg-slate-50 p-2 rounded-xl text-xs font-bold" value={formData.investmentReturn} onChange={e=>setFormData(p=>({...p, investmentReturn:Number(e.target.value)}))} />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <button onClick={generateAIAdvice} disabled={isGenerating} className="w-full bg-slate-900 text-white p-5 rounded-2xl font-black text-xs hover:bg-slate-800 transition-all flex items-center justify-center gap-2 shadow-lg">
                                    {isGenerating ? <Loader2 className="animate-spin" size={16} /> : <BrainCircuit size={16} />}
                                    生成深度资产审计报告
                                </button>
                            </div>

                            {/* Visualization */}
                            <div className="lg:col-span-8 space-y-6">
                                <div className="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-200 min-h-[500px]">
                                    {aiAdvice ? (
                                        <div className="space-y-4 animate-in fade-in">
                                            <div className="flex justify-between items-center border-b pb-4">
                                                <h2 className="font-black text-lg">深度审计报告 (AI Generated)</h2>
                                                <button onClick={() => setAiAdvice("")} className="text-[10px] font-bold bg-slate-100 px-3 py-1 rounded-lg">返回模型</button>
                                            </div>
                                            <div className="text-sm text-slate-600 leading-relaxed whitespace-pre-wrap">{aiAdvice}</div>
                                        </div>
                                    ) : (
                                        <>
                                            <div className="mb-8">
                                                <h2 className="text-xl font-black tracking-tight">损益平衡与资产波动映射</h2>
                                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Financial Position & Asset Volatility</p>
                                            </div>

                                            <div className="h-[380px]">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <ComposedChart data={analysis.chartData}>
                                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                                        <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: '#94a3b8', fontSize: 11}} dy={10} />
                                                        <YAxis axisLine={false} tickLine={false} tick={{fill: '#94a3b8', fontSize: 10}} tickFormatter={v => `¥${v/1000}k`} />
                                                        <Tooltip contentStyle={{borderRadius: '16px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)'}} />

                                                        <Bar dataKey="资产增值贬值" fill={formData.propertyAppreciation < 0 ? "#fda4af" : "#6ee7b7"} radius={[4, 4, 0, 0]} />
                                                        <Bar dataKey="结婚生育成本" fill="#f59e0b" radius={[4, 4, 0, 0]} />
                                                        <Bar dataKey="投资与支持" fill="#93c5fd" radius={[4, 4, 0, 0]} />

                                                        <Area type="monotone" dataKey="净现金流" fill="#f8fafc" stroke="#64748b" strokeWidth={1} fillOpacity={0.5} />

                                                        <Line
                                                            type="monotone"
                                                            dataKey="综合家庭损益"
                                                            stroke="#0f172a"
                                                            strokeWidth={3}
                                                            dot={(props) => {
                                                                const { cx, cy, payload, index } = props;
                                                                return <circle key={`dot-${index}`} cx={cx} cy={cy} r={4} fill={payload.综合家庭损益 < 0 ? '#f43f5e' : '#0f172a'} stroke="#fff" strokeWidth={2} />;
                                                            }}
                                                        />
                                                        <ReferenceLine y={0} stroke="#94a3b8" strokeDasharray="3 3" />
                                                    </ComposedChart>
                                                </ResponsiveContainer>
                                            </div>

                                            <div className="grid grid-cols-3 gap-4 mt-8">
                                                <div className="p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                                    <span className="text-[9px] font-bold text-slate-400 block mb-1">现金流警戒线</span>
                                                    <div className={`text-lg font-black ${analysis.minCashFlowSurplus < 0 ? 'text-rose-500' : 'text-slate-700'}`}>
                                                        ¥{(analysis.minCashFlowSurplus / 10000).toFixed(1)}w
                                                    </div>
                                                </div>
                                                <div className="p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                                    <span className="text-[9px] font-bold text-slate-400 block mb-1">资产贬值风险(18y)</span>
                                                    <div className="text-lg font-black text-rose-500">
                                                        {formData.propertyAppreciation < 0 ? `¥${(Math.abs(formData.propertyValue * (Math.pow(1+formData.propertyAppreciation/100, 18) - 1)) / 10000).toFixed(0)}w` : '无'}
                                                    </div>
                                                </div>
                                                <div className="p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                                    <span className="text-[9px] font-bold text-slate-400 block mb-1">生存抗风险系数</span>
                                                    <div className="text-lg font-black text-emerald-500">
                                                        {((formData.salaryA + formData.salaryB + formData.annualParentSupport/12) / (formData.monthlyMortgage + formData.baseLivingCost)).toFixed(2)}
                                                    </div>
                                                </div>
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>